<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Notes Project - Leave a Note</title>
    <style>
        body { 
            margin: 0; padding: 20px; 
            background: linear-gradient(135deg, #001f3f, #0a2540, #000080); 
            color: #e0e0e0; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            overflow: auto;
        }
        form { 
            background: rgba(0,0,50,0.8); 
            padding: 40px; border-radius: 20px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.5); 
            border: 2px solid #4169e1; 
            max-width: 500px; width: 100%;
        }
        h1 { text-align: center; color: #4169e1; margin-bottom: 30px; text-shadow: 0 0 10px #4169e1; }
        label { display: block; margin: 20px 0 5px; font-weight: bold; }
        textarea { 
            width: 100%; height: 150px; 
            background: rgba(255,255,255,0.1); 
            border: 1px solid #4169e1; border-radius: 10px; 
            padding: 15px; color: #e0e0e0; 
            font-size: 16px; resize: vertical;
            box-sizing: border-box;
        }
        textarea::placeholder { color: #888; }
        button { 
            width: 100%; padding: 15px; 
            background: linear-gradient(#4169e1, #0000cd); 
            border: none; border-radius: 10px; 
            color: white; font-size: 18px; font-weight: bold; 
            cursor: pointer; 
            box-shadow: 0 5px 15px rgba(65,105,225,0.4);
            transition: all 0.3s;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(65,105,225,0.6); }
        button:active { transform: translateY(0); }
        .info { text-align: center; margin-top: 20px; font-size: 14px; color: #aaa; }
    </style>
</head>
<body>
    <form id="noteForm">
        <h1>üìù The Notes Project</h1>
        <label for="content">Your Note (max 300 chars):</label>
        <textarea id="content" placeholder="Leave your message here..." maxlength="300" required></textarea>
        <div class="info" id="info">Loading...</div>
        <button type="submit">Submit Note</button>
    </form>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const x = parseFloat(urlParams.get('x'));
        const y = parseFloat(urlParams.get('y'));
        const z = parseFloat(urlParams.get('z'));
        const user = decodeURIComponent(urlParams.get('user') || '');
        const dbUrl = 'YOUR-DB-URL-HERE/notes';  // e.g., https://notesproject-abc123-default-rtdb.us-central1.firebasedatabase.app/notes
        const userkey = user.replace(/[\.\#\$\[\]]/g, '_');
        document.getElementById('info').innerHTML = `Position: (${x?.toFixed(1) ?? 0}, ${y?.toFixed(1) ?? 0}, ${z?.toFixed(1) ?? 0})<br>Author: ${user}`;
        document.getElementById('noteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const content = document.getElementById('content').value.trim();
            if (content.length === 0 || content.length > 300) return alert('Note must be 1-300 chars.');
            const data = { username: user, date: new Date().toISOString(), content, x, y, z };
            try {
                const res = await fetch(`${dbUrl}/${userkey}.json`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (res.ok) {
                    alert('Note saved! Refresh in-world to see it.');
                } else {
                    alert('Save failed. Try again.');
                }
            } catch (err) {
                alert('Network error: ' + err.message);
            }
        });
    </script>
</body>
</html>
